\documentclass{emulateapj}

\usepackage{color}
%\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage{graphicx}
\usepackage[backref,breaklinks,colorlinks,citecolor=blue]{hyperref}
\usepackage[all]{hypcap}
\usepackage{amsmath}

\usepackage{enumitem}
\setitemize{itemsep=0pt}
%\setlist{nolistsep} %really really no itemsep

%\usepackage{url}
%\graphicspath{{figures/}}

\usepackage{listings}
\definecolor{lbcolor}{rgb}{0.9,0.9,0.9}
\lstset{language=Python,
        basicstyle=\footnotesize\ttfamily, %smaller font for blocks of code
        %numbers=left,
        xleftmargin=2em,
        showspaces=false,
        showstringspaces=false,
        tabsize=2,
        breaklines=false,
        breakatwhitespace=true,
        identifierstyle=\ttfamily,
        keywordstyle=\bfseries\color[rgb]{0.133,0.545,0.133}, %forestgreen
        commentstyle=\bfseries\itshape\color[rgb]{0.372, 0.619, 0.627}, %cadetblue
        stringstyle=\color[rgb]{0.627,0.126,0.941},
        %keywordstyle=\bfseries\color[rgb]{0.133,0.545,0.133},
        %commentstyle=\color[rgb]{0.133,0.545,0.133},
        %stringstyle=\color[rgb]{0.627,0.126,0.941},
    }

\lstdefinestyle{codeintext}{language=Python, basicstyle=\ttfamily} %normal size font for in text
\newcommand{\code}{\lstinline[style=codeintext]}
\lstdefinestyle{codeinheader}{language=Python, basicstyle=\large\ttfamily} %bigger size font for in headers
\newcommand{\hcode}{\lstinline[style=codeinheader]}

\newcommand{\attn}[2][red]{\textcolor{#1}{\textit{#2}}}
\renewcommand*{\backref}[1]{[#1]}

\begin{document}

\title{\MakeLowercase{\hcode{cluster-lensing}}: a \hcode{P}\MakeLowercase{\hcode{ython}} Package for Galaxy Clusters and Miscentering}

\author{
Jes Ford\altaffilmark{1},
Jake VanderPlas\altaffilmark{1}
}
\altaffiltext{1}{eScience Institute, University of Washington \\  \hspace*{0.5cm}contact: \email{jesford@uw.edu}}

\shorttitle{\code{cluster-lensing}}
\shortauthors{J.Ford \& J. VanderPlas}


\begin{abstract}
We describe a new open source package for calculating properties of galaxy clusters, including NFW halo profiles with and without the effects of cluster miscentering. This pure-\code{Python} package, \code{cluster-lensing}, provides well-documented and easy-to-use classes and functions for calculating cluster scaling relations, including mass-richness and mass-concentration relations from the literature, as well as the surface mass density $\Sigma(R)$ and differential surface mass density $\Delta\Sigma(R)$ profiles, probed by weak lensing magnification and shear, respectively. Galaxy cluster miscentering is especially a concern for stacked weak lensing shear studies of galaxy clusters, where offsets between the assumed and the true underlying matter distribution
This software has been developed and released in a public GitHub repository, and is licensed under the permissive free MIT license. The \code{cluster-lensing} package can be downloaded through the Python Package Index, \url{https://pypi.python.org/pypi/cluster-lensing}, or directly from GitHub, at \url{https://github.com/jesford/cluster-lensing}. Full documentation is available at \url{http://jesford.github.io/cluster-lensing/}.
\end{abstract}

\keywords{methods: data analysis -- methods: numerical -- galaxies: clusters: general -- gravitational lensing: weak -- dark matter}

\setcounter{section}{0}
\setcounter{subsection}{0}
\setcounter{subsubsection}{0}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Introduction}
\label{intro}

Clusters of galaxies are the largest gravitationally collapsed structures to have formed in the history of the universe.  As such, they are interesting both from a cosmological as well as an astrophysics perspective. In the former case, the galaxy cluster number density as a function of mass (the cluster mass function) is a probe of cosmological parameters including the fractional matter density $\Omega_{\rm m}$ and the normalization of the matter power spectrum $\sigma_8$. Astrophysically, the deep potential wells of galaxy clusters are environments useful for testing theories of general relativity, galaxy evolution, and gas and plasma physics, among other things \citep{Voit05}. 

The common thread among these diverse investigations is the requisite knowledge of the mass of the galaxy cluster, which is largely composed of its invisible dark matter halo. Although many techniques exist for estimated the total mass of these systems, weak lensing has emerged as somewhat of a gold standard, since it is sensitive to the mass itself, and not to the dynamical state or other biased tracers of the underlying mass. Scaling relations between weak lensing derived masses, and other observables, including richness, X-ray luminosity and temperature, for examples, are typically calibrated from large surveys and extrapolated to clusters for which gravitational lensing measurements are impossible or unreliable. Since weak lensing masses are often considered the ``true'' masses, against which other estimates are compared \citep[e.g.][]{Leauthaud10, vonderLinden14, Hoekstra15}, it is paramount that cluster masses from weak lensing modeling are as unbiased as possible.

For stacked weak lensing measurements of galaxy clusters, an important source of bias in fitting a mass model is the inclusion of the effect of miscentering offsets. Miscentering occurs when the center of the mass distribution, the dark matter halo, does not perfectly coincide with the assumed center around which tangential shear (or magnification) profiles are being measured. Candidate centers for galaxy clusters are necessarily chosen from observational proxies, and often include a single galaxy, such as the brightest or most massive cluster galaxy, or the centroid of some extended quantity like the peak of X-ray emission or average of galaxy positions \citep{George12}. The particular choice of center may be offset from the true center due to interesting physical processes such as recent mergers and cluster evolution, or simply due to misidentification of the proxy of interest \citep{Johnston07}. 

The miscentering effect on the stacked weak lensing profile can be included in a proper modeling of the measurement, as done in \citet{Johnston07, Mandelbaum10, Oguri11, George12, Sehgal13, Oguri14, Ford14, Ford15, Simet16}. The inclusion of this effect commonly assumes a form for the distribution of offsets, such as a Rayleigh distribution in radius (which represents a 2D Gaussian in the plane of the sky), which is convolved with the centered profile. Software for performing the integrations for the miscentered weak lensing profiles was developed in order to produce results in \citet{Ford14, Ford15}, and has recently been publicly released to the astronomical community.\footnote{\url{https://github.com/jesford/cluster-lensing}}

When many different gravitational lenses are stacked, as is usually necessary to increase signal-to-noise for weak lensing measurements, care must be taken in the interpretation of the average signal. The issue here is that the (differential) surface mass density is not a linear function of the mass, so the average of many stacked profiles does not directly yield the average mass of the lens sample. Care must be taken to consider the underlying distribution of cluster masses as well as the redshifts of lenses and sources, all of which affect the amplitude of the measured lensing profile. One approach to this is to use a so-called composite-halo approach \citep[e.g.][]{Hildebrandt11, Ford12, Ford14, Ford15, Simet16}, where profiles are calculated for all individual lens objects and then averaged together to create a model that can be fit to the measurement. The \code{ClusterEnsemble()} class discussed in Section \ref{clusters} is designed with this approach in mind.

\begin{itemize}
\item Background about clusters and weak lensing.
\item NFW halos \citep{nfw97, Wright00}
\item composite-NFW fits for weak lensing \citep{Ford12, Ford14, Ford15}
\item What is new = miscentering \citep{Johnston07, George12, Ford14, Ford15}
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Description of the Code}
\label{code}

In this section we describe each of the individual modules and a few of the functions available in the \code{cluster-lensing} package. Much of this content comes directly from pages within the online documentation.\footnote{\url{http://jesford.github.io/cluster-lensing/}} Throughout the modules, dimensionful quantities are labelled as such by means of the \code{astropy.units} package \citep{astropy13}.

\begin{itemize} 
\item Purpose and general use.
\item Relation to existing code
\item \code{SurfaceMassDensity()} class, generic to all NFW halos
\item \code{ClusterEnsemble()} class
\item mass-richness functions
\item mass-concentration functions
\item We use units from the \code{astropy.units} package \citep{astropy13}.
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{\normalfont{\hcode{nfw.py}}}
\label{nfw}

The \code{nfw.py} module contains a single class called \code{SurfaceMassDensity()}, which computes the surface mass density $\Sigma(R)$ and the differential surface mass density $\Delta\Sigma(R)$ using the class methods \code{sigma_nfw()} and \code{deltasigma_nfw()}, respectively. These profiles are calculated according to the analytical formulas first derived by \citet{Wright00}, assuming the spherical NFW model, and can be applied to any dark matter halo: \emph{this module is not specific to galaxy clusters}. 

The 3-dimensional density profile of an NFW halo is given by 
\begin{equation}
\rho(r) = \frac{\delta_{\rm c} \rho_{\rm crit}}{(r/r_{\rm s})(1+r/r_{\rm s})^2},
\end{equation}
where $r_{\rm s}$ is the cluster scale radius, $\delta_{\rm c}$ is the characteristic halo overdensity, and $\rho_{\rm crit} = \rho_{\rm crit}(z)$ is the critical energy density of the universe at the lens redshift. These three parameters\footnote{or, in the case of calculating multiple NFW halos at once, three array-like objects representing each of these parameters} must be specified when instantiating the class \code{SurfaceMassDensity()}, via the arguments \code{rs}, \code{delta_c}, and \code{rho_crit}, respectively. The user will probably also want to choose the radial bins for the calculation, which are specified via the keyword argument \code{rbins}. The surface mass density is the integral along the line-of-sight of the 3-dimensional density:
\begin{equation}
\Sigma(R) = 2 \int_0^{\infty} \rho(R,y) {\rm d}y.
\end{equation}
Here $R$ is the projected radial distance (in the plane of the sky).  

We can adopt the dimensional radius $x \equiv R/r_{\rm s}$, and show that \attn{(need to edit these equations to the form that I actually implemented, which rewrites arctanh in terms of ln)}:
\begin{equation}\label{sigma}
\Sigma(x) = 
    \begin{cases}
        \frac{2 r_{\rm s} \delta_{\rm c} \rho_{\rm crit}}{(x^2 - 1)} \left[ 1 - \frac{2}{\sqrt{1-x^2}} {\rm arctanh} \sqrt{\frac{1-x}{1+x}} \ \right], \hfill \text{for } x < 1; \\
        \frac{2 r_{\rm s} \delta_{\rm c} \rho_{\rm crit}}{3}, \hfill \text{for } x = 1; \\
        \frac{2 r_{\rm s} \delta_{\rm c} \rho_{\rm crit}}{(x^2 - 1)} \left[ 1 - \frac{2}{\sqrt{x^2 - 1}} {\rm arctan} \sqrt{\frac{x-1}{1+x}} \ \right], \hfill \text{for } x < 1.
    \end{cases}
\end{equation}
The differential surface mass density probed by shear is calculated from the definiton
\begin{equation}\label{dsigma}
\Delta\Sigma(x) \equiv  \overline{\Sigma}(<x) - \Sigma(x),
\end{equation}
where
\begin{equation}\label{sigbar}
%\begin{split}
\overline{\Sigma}(<x) = \frac{2}{x^2} \int_0^{x} \Sigma(x') x' {\rm d}x' 
\end{equation}
\begin{equation}
  %\overline{\Sigma}(<x) =
  =
    \begin{cases}
        \frac{4 r_{\rm s} \delta_{\rm c} \rho_{\rm crit}}{x^2} \left[ \frac{2}{\sqrt{1-x^2}} {\rm arctanh} \sqrt{\frac{1-x}{1+x}} + {\rm ln}(1/2) \right], \\ \hfill \text{for } x < 1; \\
        4 r_{\rm s} \delta_{\rm c} \rho_{\rm crit} \left[ 1 + {\rm ln}(1/2) \right], \hfill \text{for } x = 1; \\
        \frac{4 r_{\rm s} \delta_{\rm c} \rho_{\rm crit}}{x^2} \left[ \frac{2}{\sqrt{x^2 - 1}} {\rm arctan} \sqrt{\frac{x-1}{1+x}} + {\rm ln}(1/2) \right], \\ \hfill \text{for } x < 1
    \end{cases}
  %\end{split}
\end{equation}
\citep{Wright00}.

% Note: I never coded the below equation, only the one above.
%\begin{equation}
%\Delta\Sigma(x) =
%    \begin{cases}
%    r_{\rm s} \delta_{\rm c} \rho_{\rm crit} \bigg[ \frac{8\ {\rm arctanh}\sqrt{(1 - x)/(1 + x)}}{x^2 \sqrt{1 - x^2}} + \frac{4}{x^2}\ln(\frac{x}{2}) \\ - \frac{2}{(x^2 - 1)} + \frac{4\ {\rm arctanh}\sqrt{(1 - x)/(1 + x)}}{(x^2 - 1) \sqrt{1 - x^2}} \bigg], \hfill \text{for } x < 1; \\
%    r_{\rm s} \delta_{\rm c} \rho_{\rm crit} [ \frac{10}{3} + 4 \ln(\frac{1}{2}) ], \hfill \text{for } x = 1; \\
%    r_{\rm s} \delta_{\rm c} \rho_{\rm crit} \bigg[ \frac{8\ {\rm arctanh}\sqrt{(x - 1)/(1 + x)}}{x^2 \sqrt{x^2 - 1}} + \frac{4}{x^2}\ln(\frac{x}{2}) \\ - \frac{2}{(x^2 - 1)} + \frac{4\ {\rm arctanh}\sqrt{(x - 1)/(1 + x)}}{(x^2 - 1)^{3/2}} \bigg], \hfill \text{for } x > 1.
%    \end{cases}
%\end{equation}

Running \code{sigma_nfw()} or \code{deltasigma_nfw()}, with only a specification of halo properties \code{rs}, \code{delta_c}, \code{rho_crit}, and radial bins \code{rbins}, will lead to the calculation of halo profiles according to Equations \ref{sigma} and \ref{dsigma} outlined above. These are the standard centered NFW profiles, under the assumption that the peak of the halo density distribution perfectly coincides with the identified halo center. This may not be a good assumption, however, and the user can instead run these calculations for miscentered halos by specifying the optional input parameter \code{offsets}. This parameter sets the width of a distribution of centroid offsets, assuming a 2-dimensional Gaussian distribution on the sky. This offset distribution is equivalent to, and implemented in code as, a uniform distribution in angle and a Rayleigh probability distribution in $R$:
\begin{equation}\label{PofR}
P(R_{\mathrm{off}})=\frac{R_{\mathrm{off}}}{\sigma_{\mathrm{off}}^2}\ \mathrm{exp}\bigg[-\frac{1}{2}\bigg(\frac{R_{\mathrm{off}}}{\sigma_{\mathrm{off}}}\bigg)^2\ \bigg].
\end{equation}
The parameter \code{offsets} is equivalent to $\sigma_{\rm off}$ in this equation.

The miscentered surface mass density profiles are given by the centered profiles (Equations \ref{sigma} and \ref{dsigma}), convolved with the offset distribution (Equation \ref{PofR}). We follow the offset halo formalism first written down by \citet{Yang06}, and applied to cluster miscentering by, {\textit e.g.} \citet{Johnston07, George12, Ford14, Ford15, Simet16}. Specifically, we calculate the offset surface mass density $\Sigma^{\rm off}$ as follows:
\begin{equation}
\Sigma^{\rm off}(R) = \int_{0}^{\infty} \Sigma(R | R_{\rm off})\ P(R_{\rm off})\ {\rm d}R_{\rm off}
\end{equation}
\begin{equation}
\Sigma(R|R_{\mathrm{off}})=\frac{1}{2\pi}\int_{0}^{2\pi}\Sigma(r) \mathrm{d}\theta
\end{equation}
Here $r = \sqrt{R^2+R_{\mathrm{off}}^2-2RR_{\mathrm{off}}\cos(\theta)}$ and $\theta$ is the azimuthal angle \citep{Yang06}. The $\Delta\Sigma^{\rm off}$ profile is calculated from $\Sigma^{\rm off}$, in analogy with Equations \ref{dsigma} and \ref{sigbar}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{\normalfont{\hcode{cofm.py}}}
\label{cofm}

The \code{cofm.py} module currently contains three functions, each of which calculates halo concentration from mass, redshift, and cosmology, according to a prescription given in the literature. These functions are \code{c_DuttonMaccio()} \citep[for calculations following][]{Dutton14}, \code{c_Duffy()} \citep[following][]{Duffy08}, and \code{c_Prada()} \citep[for][]{Prada12}. Halo mass-concentration relations are an area of active research, and there have been discrepancies between results from different observations and simulations, and disagreement surrounding the best choice of model \attn{(add references)}. We do not aim to join this discussion here, but focus on outlining the functionality provided by the \code{cluster-lensing} package, for calculating these different concentration values.

All three functions require two input parameters (scalars or array-like inputs), which are the halo redshift(s) \code{z} and the halo mass(es) \code{m}. Specifically, the latter is according to the $M_{200}$ mass definition, in units of solar masses (optionally with corresponding \code{astropy.units}). $M_{200}$ is the mass interior to a sphere of radius $r_{200}$, within which the average density is $200\rho_{\rm crit}(z)$. 

The default cosmology used is from the measurements by the \citet{PlanckXVI}, which is imported from the module \code{astropy.cosmology.Planck13}. However, the user can specify alternative cosmological parameters. For calculating concentration according to either the \citet{Duffy08} or the \citet{Dutton14} prescription, the only cosmological parameter required is the Hubble parameter, which can be passed into \code{c_Duffy()} or \code{c_DuttonMaccio()} as the keyword argument \code{h}. For the \citet{Prada12} concentration, the user would want to specify \code{Om_M} and \code{Om_L} (the fractional energy densities of matter and the cosmological constant) in addition to \code{h}, in the call to \code{c_Prada()}.

The \code{c_DuttonMaccio()} calculation of concentration is done according to the power-law
\begin{equation}
\log_{10} c_{200} = a + b \log_{10}(M_{200} / [10^{12} h^{-1} M_{\odot}]), 
\end{equation}
where
\begin{equation}
a = 0.52 + 0.385 \cdot {\rm exp}[-0.617\ z^{1.21}],
\end{equation}
\begin{equation}
b = -0.101 + 0.206 z.
\end{equation}
The above three equations map to Equations 7, 11, and 10, respectively in \citet{Dutton14}. The values in these expressions were determined from simulations of halos between $0 < z < 5$, spanning over 5 orders of magnitude in mass, and shown to match observational measurements of low-redshift galaxies and clusters \citep{Dutton14}. This concentration-mass relation is the default one used by the \code{clusters.py} module

%---------- code ----------
\begin{lstlisting}
from clusterlensing import cofm
# single 10^14 Msun halo at z=1
cofm.c_DuttonMaccio(0.1, 1e14)
array([ 5.13397936])
# example with multiple halos
cofm.c_DuttonMaccio([0.1, 0.5], [1e14, 1e15])
array([ 5.13397936,  3.67907305])
\end{lstlisting}
%----------------------------

The concentration calculation in \code{c_Duffy()} is
\begin{equation}\label{c_Duffy}
c_{200} = A \cdot (M_{200} / M_{\rm pivot})^B \cdot (1 + z)^C,
\end{equation}
where
\begin{equation}
\{A, B, C\} = \{5.71, -0.084, -0.47\},
\end{equation}
\begin{equation}
M_{\rm pivot} = 2 \times 10^{12}\ h^{-1} M_{\odot}.
\end{equation}
Equation \ref{c_Duffy} in this work maps to Equation 4 in \citet{Duffy08}. The values for $A$, $B$, and $C$ can be found in Table 1 of that work, where they are specific to the ``full'' (relaxed and unrelaxed) sample of simulated NFW halos, spanning the redshift range $0 < z < 2$. $M_{\rm pivot}$ can be found in the caption of Table 1 as well. One caveat with this relation is that the cosmology used in creating the \citet{Duffy08} simulations was that of the now outdated WMAP5 experiment \citep{WMAP5}.

%---------- code ----------
\begin{lstlisting}
from clusterlensing import cofm
# default cosmology, h=0.6777
cofm.c_Duffy([0.1, 0.5], [1e14, 1e15])
array([ 4.06126115,  2.89302767])
# with h=1
cofm.c_Duffy([0.1, 0.5], [1e14, 1e15], h=1)
array([ 3.93068341,  2.80001099])
\end{lstlisting}
%----------------------------


The \code{c_Prada()} concentration calculation is much more complex, and written in terms of $\sigma(M_{200}, x_{\rm p})$, the rms fluctuation of the density field. The \citet{Prada12} halo concentration is given by\footnote{we use the subscript ``p'' to distinguish some variables in their paper from the current work}
\begin{equation}\label{c_Prada}
\begin{split}
c_{200} = 2.881 B_0 (x_{\rm p}) \bigg[ \left( \frac{B_1(x_{\rm p}) \sigma(M_{200},x_{\rm p})}{1.257} \right)^{1.022} + 1 \bigg] \\
\times\ {\rm exp}\left( \frac{0.06}{[B_1(x_{\rm p}) \sigma(M_{200},x_{\rm p}) ]^2} \right).
\end{split}
\end{equation}
The cosmology and redshift dependence is encoded by the variable $x_{\rm p}$, which is  
\begin{equation}
x_{\rm p} = \left( \frac{\Omega_{\Lambda, 0}}{\Omega_{{\rm m}, 0}} \right)^{1/3} (1 + z)^{-1}.
\end{equation}
The functions within Equation \ref{c_Prada} are as follows:
\begin{equation}
\sigma(M_{200},x_{\rm p}) = D(x_{\rm p}) \frac{16.9 y_{\rm p}^{0.41}}{1 + 1.102 y_{\rm p}^{0.2} + 6.22 y_{\rm p}^{0.333}}
\end{equation}
\begin{equation}
y_{\rm p} \equiv \frac{10^{12} h^{-1} M_{\odot}}{M_{200}}
\end{equation}
\begin{equation}
D(x_{\rm p}) = \frac{5}{2} \left( \frac{\Omega_{{\rm m}, 0}}{\Omega_{\Lambda, 0}} \right)^{1/3} \frac{\sqrt{1 + x_{\rm p}^3}}{x_{\rm p}^{3/2}} \int_0^{x_{\rm p}} \frac{x^{3/2} {\rm d}x}{(1 + x^3)^{3/2}}
\end{equation}
\begin{equation}
B_0(x_{\rm p}) = \frac{c_{\rm min}(x_{\rm p})}{c_{\rm min}(1.393)}
\end{equation}
\begin{equation}
B_1(x_{\rm p}) = \frac{\sigma^{-1}_{\rm min}(x_{\rm p})}{\sigma^{-1}_{\rm min}(1.393)}
\end{equation}
\begin{equation}
c_{\rm min}(x_{\rm p}) = 3.681 + 1.352 \bigg[ \frac{1}{\pi} \arctan[6.948 (x_{\rm p} - 0.424)] + \frac{1}{2} \bigg]
\end{equation}
\begin{equation}
\sigma^{-1}_{\rm min}(x_{\rm p}) = 1.047 + 0.599 \bigg[ \frac{1}{\pi} \arctan[7.386 (x_{\rm p} - 0.526)] + \frac{1}{2} \bigg]
\end{equation}
In order of appearance above, beginning with our Equation \ref{c_Prada}, these equations correspond to Equations 14-17, 13, 23a, 23b, 12, 18a, 18b, 19, 20 in \citet{Prada12}. The numerical values in these equations are obtained from the simulations described in that work.

%---------- code ----------
\begin{lstlisting}
from clusterlensing import cofm
cofm.c_Prada([0.1, 0.5], [1e14, 1e15])
array([ 5.06733941,  5.99897362])
\end{lstlisting}
%----------------------------

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{\normalfont{\hcode{clusters.py}}}
\label{clusters}
The \code{clusters.py} module is designed to provide a catalog-level tool for calculating, tracking, and updating galaxy cluster properties and profiles, through structuring data from multiple clusters as an updatable Pandas Dataframe, and providing an intelligent interface to the other modules discussed in Sections \ref{nfw} and \ref{cofm}. This module contains a single class \code{ClusterEnsemble()}, as well as three functions, \code{mass_to_richness()}, \code{richness_to_mass()}, and \code{calc_delta_c()}.

The function \code{calc_delta_c()} takes a single input parameter, the cluster concentration \code{c200} (\emph{e.g.} as calculated by one of the functions in \code{cofm.py}), and returns the characteristic halo overdensity:
\begin{equation}
\delta_{\rm c} = \left( \frac{200}{3} \right) \frac{c_{200}^3}{\ln(1 + c_{200}) - c_{200}/(1 + c_{200})}.
\end{equation}
Both input and output are dimensionless here.

The pair of functions \code{mass_to_richness()} and \code{richness_to_mass()}, as their names imply, perform conversions between cluster mass and richness. The only required input parameter to \code{mass_to_richness()} is the \code{mass}, and likewise the only required input to \code{richness_to_mass()} is \code{richness}. The calculations assume a power-law form for the relationship between these variables:
\begin{equation}
M_{200} = M_0 \left( \frac{N_{200}}{20} \right) ^ \beta.
\end{equation}
Here $M_0$ is the normalization, which defaults to $2.7 \times 10^{13}$, but can be changed in the call to either function by setting the \code{norm} keyword argument. The power-law slope $\beta = 1.4$ by default, but can be set by specifying the optional \code{slope} input parameter. When these functions are invoked by the \code{ClusterEnsemble()} class, they are applied to the particular mass definition $M_{200}$, and assume units of $M_{\odot}$. However the functions themselves do not assume a mass definition or unit, and can be generalized to any parameter (or type of richness) that has a power-law relationship with mass.

The \code{ClusterEnsemble()} class...

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Examples}
\label{ex}

\begin{itemize}
\item No miscentering
\item With miscentering
\item others...
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Future Development}
\label{future}

Plans for the future.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Summary}
\label{summary}

Summary goes here.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\vspace{10.pt}

\section*{Acknowledgements}
The authors are grateful for funding from the Washington Research Foundation Fund for Innovation in Data-Intensive Discovery and the Moore/Sloan Data Science Environments Project at the University of Washington. This project makes use of Astropy, a community-developed core Python package for Astronomy (Astropy Collaboration, 2013), \url{http://www.astropy.org}.


\bibliographystyle{apj}
\bibliography{References}

\end{document}
